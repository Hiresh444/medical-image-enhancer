{% extends "base.html" %}
{% block title %}Agent Logs — {{ run_id }} — MDIMG QA{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="bi bi-journal-text me-2"></i>Agent Traces</h3>
    <a href="{{ url_for('result', run_id=run_id) }}" class="btn btn-outline-primary btn-sm">
        <i class="bi bi-clipboard-data me-1"></i>Results
    </a>
</div>

{% if traces %}
<div class="accordion" id="traceAccordion">
    {% for trace in traces %}
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button {{ '' if loop.first else 'collapsed' }}"
                    type="button" data-bs-toggle="collapse"
                    data-bs-target="#trace{{ loop.index }}">
                <span class="badge bg-info me-2">{{ trace.get('event', 'trace') }}</span>
                <span class="me-2">{{ trace.get('phase', '') }}</span>
                <small class="text-muted">{{ trace.get('timestamp', '') }}</small>
            </button>
        </h2>
        <div id="trace{{ loop.index }}"
             class="accordion-collapse collapse {{ 'show' if loop.first else '' }}"
             data-bs-parent="#traceAccordion">
            <div class="accordion-body">
                {% if trace.get('data') %}
                <pre class="bg-dark text-light p-3 rounded" style="max-height:400px;overflow:auto;"><code>{{ trace.data | tojson(indent=2) }}</code></pre>
                {% endif %}
                {% if trace.get('message') %}
                <p>{{ trace.message }}</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-journal-x fs-1 text-muted"></i>
    <p class="text-muted mt-2">No agent traces found for this run.</p>
</div>
{% endif %}
{% endblock %}
