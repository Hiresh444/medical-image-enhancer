{% extends "base.html" %}
{% block title %}Upload DICOM — MDIMG QA{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header">
                <h4 class="mb-0"><i class="bi bi-upload me-2"></i>Upload DICOM Image</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('run') }}" enctype="multipart/form-data" id="uploadForm">
                    {% if csrf %}
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    {% endif %}

                    <!-- Drop zone -->
                    <div class="drop-zone border border-2 border-dashed rounded p-5 text-center mb-4" id="dropZone">
                        <i class="bi bi-cloud-arrow-up display-3 text-muted"></i>
                        <p class="mt-2 mb-1">Drag & drop a DICOM file here, or click to browse</p>
                        <small class="text-muted">Accepted: .dcm, .dicom — Max 50 MB</small>
                        <input type="file" name="file" id="fileInput" accept=".dcm,.dicom,.DCM,.DICOM" class="d-none">
                    </div>

                    <div id="fileInfo" class="alert alert-info d-none">
                        <i class="bi bi-file-earmark-medical me-1"></i>
                        <span id="fileName"></span>
                        <span class="text-muted ms-2" id="fileSize"></span>
                    </div>

                    <!-- Options -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="genaiToggle" name="genai" value="on">
                                <label class="form-check-label" for="genaiToggle">
                                    <i class="bi bi-robot me-1"></i>Enable GenAI Mode
                                </label>
                            </div>
                            <small class="text-muted">Uses LLM for planning, tuning & explainability</small>
                        </div>
                        <div class="col-md-6">
                            <label for="modelSelect" class="form-label">Model</label>
                            <select class="form-select form-select-sm" id="modelSelect" name="model">
                                <option value="gpt-5-mini" selected>gpt-5-mini (default)</option>
                                <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                                <option value="gpt-4.1">gpt-4.1</option>
                                <option value="o4-mini">o4-mini</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100" id="submitBtn" disabled>
                        <i class="bi bi-play-circle me-2"></i>Run Pipeline
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='upload.js') }}"></script>
{% endblock %}
